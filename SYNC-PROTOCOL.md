# SYNC-PROTOCOL.md — нормативный протокол синхронизации чатов (SPMS)

## 0) Область действия
Этот документ определяет, как мы синхронизируем прогресс проекта между чатами и фиксируем его в STATUS.yaml — единственном источнике истины в SPMS. :contentReference[oaicite:4]{index=4}

## 1) Часовой пояс и формат времени
- Часовой пояс: Ташкент, UTC+05:00.
- Формат времени: ISO‑8601 с оффсетом `+05:00`. Примеры:
  - `2025-08-15T19:42:10+05:00`
  - `2025-08-16T09:00:00+05:00` :contentReference[oaicite:5]{index=5}

## 2) Роли и языковая политика
- Роли: Пользователь (владелец проекта), ИИ (исполнитель по SPMS).
- Языки:
  - Общение со мной: русский (можно узбекский/японский по контексту).
  - Код/идентификаторы: язык стека (TS/JS и пр.).
- ИИ строго следует правилам SPMS: *не перескакивать этапы; одна итерация = один этап; переход только после подтверждённого DoD с evidence в STATUS.yaml*. :contentReference[oaicite:6]{index=6}

## 3) Канонический статус
- STATUS.yaml — единственный источник правды. Прошлые записи не редактируются: каждая новая — с уникальным `status_id`. :contentReference[oaicite:7]{index=7}
- Каждая запись обязательно ссылается на ID главы/этапа из ROADMAP.md. :contentReference[oaicite:8]{index=8}

## 4) Процедура в НАЧАЛЕ каждого чата
1. Пользователь (по возможности) присылает текущие артефакты: DESCRIPTION.md, ROADMAP.md, RULES.md, STATUS.yaml.
2. ИИ:
   - Подтверждает актуальную позицию в ROADMAP.md (глава/этап).
   - Уточняет у пользователя **актуальные дату и время в Ташкенте** перед любым обновлением статуса (нормативное требование). :contentReference[oaicite:9]{index=9}
   - Перечисляет план работы **только по текущему этапу** (без прыжков). :contentReference[oaicite:10]{index=10}

## 5) Процедура ВО ВРЕМЯ чата (выполнение этапа)
- ИИ работает только в рамках одного текущего этапа. :contentReference[oaicite:11]{index=11}
- Все решения, договорённости, метрики и возникающие вопросы собираются в черновик будущей записи STATUS.yaml. :contentReference[oaicite:12]{index=12}

## 6) Процедура В КОНЦЕ каждого чата
1. ИИ спрашивает у пользователя актуальные дату/время (ISO‑8601, +05:00) и фиксирует их. :contentReference[oaicite:13]{index=13}
2. ИИ создаёт **новую** запись в STATUS.yaml (новый `status_id`) со следующими полями (минимум):
   - `roadmap_ref` (ID главы/этапа),
   - `done` (что сделано за чат с привязкой к DoD),
   - `next` (следующие действия **только** по текущему этапу),
   - `evidence` (ссылки/файлы/коммиты, подтверждающие DoD),
   - `decisions`, `open_questions`, `stack`, `metrics`,
   - `timestamp` (ISO‑8601 +05:00).
   Валидация против JSON Schema (хранится рядом с STATUS.yaml). :contentReference[oaicite:14]{index=14}
3. ИИ запрашивает у пользователя подтверждение, можно ли **перейти к следующему этапу**. Без подтверждения — остаёмся на текущем. :contentReference[oaicite:15]{index=15}

## 7) Новый чат / восстановление контекста
- В новом чате пользователь даёт базовые файлы, ИИ подтверждает позицию и продолжает строго с текущего этапа. :contentReference[oaicite:16]{index=16}

## 8) Аварийные ситуации
- Если чат оборвался до выпуска новой записи STATUS.yaml, используется EMERGENCY_SYNC.yaml — минимальный снимок для восстановления (см. ниже). :contentReference[oaicite:17]{index=17}

## 9) Ссылки
- DESCRIPTION.md — редкие изменения, человекочитаемое ТЗ. :contentReference[oaicite:18]{index=18}
- ROADMAP.md — структура ГЛАВЫ→ЭТАПЫ, без дат. :contentReference[oaicite:19]{index=19}
- RULES.md — правила ИИ. :contentReference[oaicite:20]{index=20}
- STATUS.yaml — канон прогресса. :contentReference[oaicite:21]{index=21}
- EMERGENCY_SYNC.yaml — минимальный слепок на случай обрыва. :contentReference[oaicite:22]{index=22}
